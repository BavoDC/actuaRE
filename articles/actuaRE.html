<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to actuaRE ‚Ä¢ actuaRE</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to actuaRE">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">actuaRE</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/actuaRE.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to actuaRE</h1>
                        <h4 data-toc-skip class="author">Bavo D.C.
Campo</h4>
            
            <h4 data-toc-skip class="date">2025-11-28</h4>
      

      <div class="hidden name"><code>actuaRE.Rmd</code></div>

    </div>

    
    
<div>
<p><img src="actuaRE.png" class="r-plt" width="25%"></p>
</div>
<p><br clear="right"> In this document, we give you a brief overview of
the basic functionality of the <code>actuaRE</code> package. For a more
detailed overview of the functions, you can consult the help-pages.
Please feel free to send any suggestions and bug reports to the package
author.</p>
<div class="section level2">
<h2 id="handling-hierarchically-multi-level-factors-using-random-effects-models">Handling hierarchically multi-level factors using random effects
models<a class="anchor" aria-label="anchor" href="#handling-hierarchically-multi-level-factors-using-random-effects-models"></a>
</h2>
<p>Multi-level factors (MLFs) are nominal variables with too many levels
for ordinary generalized linear model (GLM) estimation <span class="citation">(Ohlsson and Johansson 2010)</span>. Within the machine
learning literature, these type of risk factors are better known as
high-cardinality attributes <span class="citation">(Micci-Barreca
2001)</span>. This package focuses on MLFs that exhibit a hierarchical
structure and a typical example hereof, within workers‚Äô compensation
insurance, is the NACE code. In our illustration, we work with a
hierarchical MLF that has two hierarchical levels: industry and branch.
Figure 1 visualizes this hierarchical structure with a hypothetical
example.</p>
<div class="figure" style="text-align: center">
<p class="caption">
Figure 1: Hierarchical structure of a hypothetical example
</p>
<img src="HierarchicalStructureAdj.png" class="r-plt" alt="Figure 1: Hierarchical structure of a hypothetical example" width="100%">
</div>
<div class="section level3">
<h3 id="which-random-effects-models-can-we-fit-using-actuare">Which random effects models can we fit using actuaRE?<a class="anchor" aria-label="anchor" href="#which-random-effects-models-can-we-fit-using-actuare"></a>
</h3>
<p>With the current version of the <code>actuaRE</code> package, you are
able to fit random effects models with the following functional form</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>E</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>Y</mi><mrow><mi>i</mi><mi>j</mi><mi>k</mi><mi>t</mi></mrow></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>U</mi><mi>j</mi></msub><mo>,</mo><msub><mi>U</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub><mo stretchy="true" form="postfix">]</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>Œº</mi><mo>+</mo><msubsup><mi>ùê±</mi><mrow><mi>i</mi><mi>j</mi><mi>k</mi><mi>t</mi></mrow><mi>‚ä§</mi></msubsup><mi>ùõÉ</mi><mo>+</mo><msub><mi>U</mi><mi>j</mi></msub><mo>+</mo><msub><mi>U</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msub><mi>Œ∂</mi><mrow><mi>i</mi><mi>j</mi><mi>k</mi><mi>t</mi></mrow></msub><mi>.</mi></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
g(E[Y_{ijkt} | U_j, U_{jk}]) &amp;= \mu + \boldsymbol{x}_{ijkt}^\top \boldsymbol{\beta} + U_j + U_{jk} \\&amp;= \zeta_{ijkt}.\\
\end{align*}</annotation></semantics></math></p>
<p>Here,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Y</mi><mrow><mi>i</mi><mi>j</mi><mi>k</mi><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">Y_{ijkt}</annotation></semantics></math>
denotes the loss cost of risk profile
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
(based on the company-specific risk factors) operating in branch
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
within industry
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
at time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>.
We calculate the loss cost as</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>Y</mi><mrow><mi>i</mi><mi>j</mi><mi>k</mi><mi>t</mi></mrow></msub><mo>=</mo><mfrac><msub><mi>Z</mi><mrow><mi>i</mi><mi>j</mi><mi>k</mi><mi>t</mi></mrow></msub><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi><mi>k</mi><mi>t</mi></mrow></msub></mfrac></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
  Y_{ijkt} = \frac{Z_{ijkt}}{w_{ijkt}}
\end{align*}</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Z</mi><mrow><mi>i</mi><mi>j</mi><mi>k</mi><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">Z_{ijkt}</annotation></semantics></math>
denotes the total claim cost and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi><mi>k</mi><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">w_{ijkt}</annotation></semantics></math>
is an appropriate volume measure.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>‚ãÖ</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">g(\cdot)</annotation></semantics></math>
denotes the link function (for example the identity or log link),
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œº</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
the intercept,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ùê±</mi><mrow><mi>i</mi><mi>j</mi><mi>k</mi><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">\boldsymbol{x}_{ijkt}</annotation></semantics></math>
the company-specific covariate vector and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùõÉ</mi><annotation encoding="application/x-tex">\boldsymbol{\beta}</annotation></semantics></math>
the corresponding parameter vector. With the model parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œº</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùõÉ</mi><annotation encoding="application/x-tex">\boldsymbol{\beta}</annotation></semantics></math>
we capture the company-specific effects. To assess the effect of the
hierarchical MLF, we introduce the random effects
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>U</mi><mi>j</mi></msub><annotation encoding="application/x-tex">U_j</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>U</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub><annotation encoding="application/x-tex">U_{jk}</annotation></semantics></math>
which capture the unobservable effects of the industry and the branch in
which the company operates.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>U</mi><mi>j</mi></msub><annotation encoding="application/x-tex">U_j</annotation></semantics></math>
denotes the industry-specific deviation from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œº</mi><mo>+</mo><msubsup><mi>ùê±</mi><mrow><mi>i</mi><mi>j</mi><mi>k</mi><mi>t</mi></mrow><mi>‚ä§</mi></msubsup><mi>ùõÉ</mi></mrow><annotation encoding="application/x-tex">\mu + \boldsymbol{x}_{ijkt}^\top \boldsymbol{\beta}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>U</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub><annotation encoding="application/x-tex">U_{jk}</annotation></semantics></math>
denotes the branch-specific deviation from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œº</mi><mo>+</mo><msubsup><mi>ùê±</mi><mrow><mi>i</mi><mi>j</mi><mi>k</mi><mi>t</mi></mrow><mi>‚ä§</mi></msubsup><mi>ùõÉ</mi><mo>+</mo><msub><mi>U</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">\mu + \boldsymbol{x}_{ijkt}^\top \boldsymbol{\beta} + U_{j}</annotation></semantics></math>.
We assume that the random industry effects
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>U</mi><mi>j</mi></msub><annotation encoding="application/x-tex">U_j</annotation></semantics></math>
are independent and identically distributed (i.i.d.) with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>U</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">E[U_j] = 0</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mi>a</mi><mi>r</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>U</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msubsup><mi>œÉ</mi><mi>I</mi><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">Var(U_j) = \sigma_{I}^2</annotation></semantics></math>.
Similarly, the random branch effects
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>U</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub><annotation encoding="application/x-tex">U_{jk}</annotation></semantics></math>
are assumed to be i.i.d. with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>U</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">E[U_{jk}] = 0</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mi>a</mi><mi>r</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>U</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msubsup><mi>œÉ</mi><mi>B</mi><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">Var(U_{jk}) = \sigma_{B}^2</annotation></semantics></math>.</p>
<p>This package offers three different estimation methods to estimate
the model parameters: <br> - Hierarchical credibility model <span class="citation">(Jewell 1975)</span> <br> - Combining the
hierarchical credibility model with a GLM <span class="citation">(Ohlsson 2008)</span> <br> - Mixed models <span class="citation">(Molenberghs and Verbeke 2005)</span></p>
</div>
<div class="section level3">
<h3 id="just-the-code-please">Just the code please<a class="anchor" aria-label="anchor" href="#just-the-code-please"></a>
</h3>
<div class="section level4">
<h4 id="example-data-set">Example data set<a class="anchor" aria-label="anchor" href="#example-data-set"></a>
</h4>
<p>To illustrate the functions, we make use of two different data sets.
We illustrate the hierarchical credibility model of Jewell <span class="citation">(Jewell 1975)</span> using the Hachemeister <span class="citation">(Hachemeister 1975)</span> data set. The other
functions make use of the <code>dataCar</code> data set.</p>
</div>
<div class="section level4">
<h4 id="hierarchical-credibility-model">Hierarchical credibility model<a class="anchor" aria-label="anchor" href="#hierarchical-credibility-model"></a>
</h4>
<p>To estimate the parameters using the hierarchical credibility model,
we use the function <code>hierCredibility</code>. By default, the
additive hierarchical credibility model <span class="citation">(Dannenburg, Kaas, and Goovaerts 1996)</span> is
fit</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>E</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>Y</mi><mrow><mi>i</mi><mi>j</mi><mi>k</mi><mi>t</mi></mrow></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>U</mi><mi>j</mi></msub><mo>,</mo><msub><mi>U</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub><mo stretchy="true" form="postfix">]</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>Œº</mi><mo>+</mo><msub><mi>U</mi><mi>j</mi></msub><mo>+</mo><msub><mi>U</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub><mi>.</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
        E[Y_{ijkt} | U_j, U_{jk}] &amp;= \mu + U_j + U_{jk}.
\end{align*}</annotation></semantics></math></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html" class="external-link">capture.output</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bavodc.github.io/websiteactuaRE/" class="external-link">actuaRE</a></span><span class="op">)</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># suppress startup message</span></span>
<span><span class="co">#&gt; Loading required package: cplm</span></span>
<span><span class="co">#&gt; Loading required package: coda</span></span>
<span><span class="co">#&gt; Loading required package: Matrix</span></span>
<span><span class="co">#&gt; Loading required package: splines</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Package 'actuaRE' version 0.1.6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; This is version 0.1.6 of actuaRE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"hachemeisterLong"</span><span class="op">)</span></span>
<span><span class="va">fitHC</span> <span class="op">=</span> <span class="fu"><a href="../reference/hierCredibility.html">hierCredibility</a></span><span class="op">(</span><span class="va">ratio</span>, <span class="va">weight</span>, <span class="va">cohort</span>, <span class="va">state</span>, <span class="va">hachemeisterLong</span><span class="op">)</span></span>
<span><span class="va">fitHC</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; hierCredibility(Yijkt = ratio, wijkt = weight, sector = cohort, </span></span>
<span><span class="co">#&gt;     group = state, data = hachemeisterLong)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Additive hierarchical credibility model</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimated variance parameters:</span></span>
<span><span class="co">#&gt;   Individual contracts: 139120026 </span></span>
<span><span class="co">#&gt;   Var(V[jk]): 11628.45 </span></span>
<span><span class="co">#&gt;   Var(V[j]): 88476.11 </span></span>
<span><span class="co">#&gt; Unique number of categories of cohort: 2</span></span>
<span><span class="co">#&gt; Unique number of categories of state: 5</span></span></code></pre></div>
<p>To fit the multiplicative hierarchical credibility model <span class="citation">(Ohlsson 2005)</span>
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>E</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>Y</mi><mrow><mi>i</mi><mi>j</mi><mi>k</mi><mi>t</mi></mrow></msub><mo stretchy="false" form="prefix">|</mo><msub><mover><mi>U</mi><mo accent="true">ÃÉ</mo></mover><mi>j</mi></msub><mo>,</mo><msub><mover><mi>U</mi><mo accent="true">ÃÉ</mo></mover><mrow><mi>j</mi><mi>k</mi></mrow></msub><mo stretchy="true" form="postfix">]</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mover><mi>Œº</mi><mo accent="true">ÃÉ</mo></mover><mspace width="0.222em"></mspace><msub><mover><mi>U</mi><mo accent="true">ÃÉ</mo></mover><mi>j</mi></msub><mspace width="0.222em"></mspace><msub><mover><mi>U</mi><mo accent="true">ÃÉ</mo></mover><mrow><mi>j</mi><mi>k</mi></mrow></msub></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
        E[Y_{ijkt} | \widetilde{U}_j, \widetilde{U}_{jk}] &amp;= \tilde{\mu} \ \widetilde{U}_j \ \widetilde{U}_{jk}
\end{align*}</annotation></semantics></math> you have to specify
<code>type = "multiplicative"</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fitHCMult</span> <span class="op">=</span> <span class="fu"><a href="../reference/hierCredibility.html">hierCredibility</a></span><span class="op">(</span><span class="va">ratio</span>, <span class="va">weight</span>, <span class="va">cohort</span>, <span class="va">state</span>, <span class="va">hachemeisterLong</span>, type <span class="op">=</span> <span class="st">"multiplicative"</span><span class="op">)</span></span>
<span><span class="va">fitHCMult</span></span></code></pre></div>
<p>To get a summary of the model fit, we use the <code>summary</code>
function.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fitHC</span><span class="op">)</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; hierCredibility(Yijkt = ratio, wijkt = weight, sector = cohort, </span></span>
<span><span class="co">#&gt;     group = state, data = hachemeisterLong)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Additive hierarchical credibility model</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimated variance parameters:</span></span>
<span><span class="co">#&gt;   Individual contracts: 139120026 </span></span>
<span><span class="co">#&gt;   Var(V[jk]): 11628.45 </span></span>
<span><span class="co">#&gt;   Var(V[j]): 88476.11 </span></span>
<span><span class="co">#&gt; Unique number of categories of cohort: 2</span></span>
<span><span class="co">#&gt; Unique number of categories of state: 5 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimates at the cohort level:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Key: &lt;cohort&gt;</span></span>
<span><span class="co">#&gt;    cohort       zj Yjz_BarTilde        qj       Vj        Uj</span></span>
<span><span class="co">#&gt;     &lt;num&gt;    &lt;num&gt;        &lt;num&gt;     &lt;num&gt;    &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      1 1.427755     1965.436 0.9157058 1946.859  201.8044</span></span>
<span><span class="co">#&gt; 2:      2 1.633248     1527.011 0.9255216 1543.250 -201.8044</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimates at the state level:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Key: &lt;cohort, state&gt;</span></span>
<span><span class="co">#&gt;    cohort state    wjk Yjk_BarTilde       zjk      Vjk       Ujk</span></span>
<span><span class="co">#&gt;     &lt;num&gt; &lt;num&gt;  &lt;num&gt;        &lt;num&gt;     &lt;num&gt;    &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      1     1 100155     2060.921 0.8932938 2048.750 101.89107</span></span>
<span><span class="co">#&gt; 2:      1     3  13735     1805.843 0.5344614 1871.491 -75.36785</span></span>
<span><span class="co">#&gt; 3:      2     2  19895     1511.224 0.6244749 1523.251 -19.99963</span></span>
<span><span class="co">#&gt; 4:      2     4   4152     1352.976 0.2576359 1494.229 -49.02155</span></span>
<span><span class="co">#&gt; 5:      2     5  36110     1599.829 0.7511373 1585.748  42.49796</span></span></code></pre></div>
<p>To obtain the fitted values, we use the <code>fitted</code>
function</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">fitHC</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 2048.750 2048.750 2048.750 2048.750 2048.750 2048.750 2048.750 2048.750</span></span>
<span><span class="co">#&gt;  [9] 2048.750 2048.750 2048.750 2048.750 1871.491 1871.491 1871.491 1871.491</span></span>
<span><span class="co">#&gt; [17] 1871.491 1871.491 1871.491 1871.491 1871.491 1871.491 1871.491 1871.491</span></span>
<span><span class="co">#&gt; [25] 1523.251 1523.251 1523.251 1523.251 1523.251 1523.251 1523.251 1523.251</span></span>
<span><span class="co">#&gt; [33] 1523.251 1523.251 1523.251 1523.251 1494.229 1494.229 1494.229 1494.229</span></span>
<span><span class="co">#&gt; [41] 1494.229 1494.229 1494.229 1494.229 1494.229 1494.229 1494.229 1494.229</span></span>
<span><span class="co">#&gt; [49] 1585.748 1585.748 1585.748 1585.748 1585.748 1585.748 1585.748 1585.748</span></span>
<span><span class="co">#&gt; [57] 1585.748 1585.748 1585.748 1585.748</span></span></code></pre></div>
<p>and we use <code>ranef</code> to extract the estimated random
effects.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ranef.html">ranef</a></span><span class="op">(</span><span class="va">fitHC</span><span class="op">)</span></span>
<span><span class="co">#&gt; $sector</span></span>
<span><span class="co">#&gt; Key: &lt;cohort&gt;</span></span>
<span><span class="co">#&gt;    cohort        Uj</span></span>
<span><span class="co">#&gt;     &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      1  201.8044</span></span>
<span><span class="co">#&gt; 2:      2 -201.8044</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $group</span></span>
<span><span class="co">#&gt; Key: &lt;cohort, state&gt;</span></span>
<span><span class="co">#&gt;    cohort state       Ujk</span></span>
<span><span class="co">#&gt;     &lt;num&gt; &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      1     1 101.89107</span></span>
<span><span class="co">#&gt; 2:      1     3 -75.36785</span></span>
<span><span class="co">#&gt; 3:      2     2 -19.99963</span></span>
<span><span class="co">#&gt; 4:      2     4 -49.02155</span></span>
<span><span class="co">#&gt; 5:      2     5  42.49796</span></span></code></pre></div>
<p>We can inspect the estimated random effects using the function
<code>plotRE</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ggPlots</span> <span class="op">=</span> <span class="fu"><a href="../reference/plotRE.html">plotRE</a></span><span class="op">(</span><span class="va">fitHC</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">ggPlots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">ggPlots</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p><img src="actuaRE_files/figure-html/unnamed-chunk-6-1.png" class="r-plt" width="700"><img src="actuaRE_files/figure-html/unnamed-chunk-6-2.png" class="r-plt" width="700"></p>
<p>To obtain predictions for a new data frame, we use the
<code>predict</code> function.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">newDt</span> <span class="op">=</span> <span class="va">hachemeisterLong</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">hachemeisterLong</span><span class="op">)</span>, <span class="fl">5</span>, <span class="cn">F</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fitHC</span>, <span class="va">newDt</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1871.491 1871.491 1523.251 1523.251 1585.748</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="combining-the-hierarchical-credibility-model-with-a-glm">Combining the hierarchical credibility model with a GLM<a class="anchor" aria-label="anchor" href="#combining-the-hierarchical-credibility-model-with-a-glm"></a>
</h4>
<p>To allow for company-specific risk factors, we extend the
multiplicative hierarchical credibility model to
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>E</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>Y</mi><mrow><mi>i</mi><mi>j</mi><mi>k</mi><mi>t</mi></mrow></msub><mo stretchy="false" form="prefix">|</mo><msub><mover><mi>U</mi><mo accent="true">ÃÉ</mo></mover><mi>j</mi></msub><mo>,</mo><msub><mover><mi>U</mi><mo accent="true">ÃÉ</mo></mover><mrow><mi>j</mi><mi>k</mi></mrow></msub><mo stretchy="true" form="postfix">]</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mover><mi>Œº</mi><mo accent="true">ÃÉ</mo></mover><mspace width="0.222em"></mspace><msub><mi>Œ≥</mi><mrow><mi>i</mi><mi>j</mi><mi>k</mi><mi>t</mi></mrow></msub><mspace width="0.222em"></mspace><msub><mover><mi>U</mi><mo accent="true">ÃÉ</mo></mover><mi>j</mi></msub><mspace width="0.222em"></mspace><msub><mover><mi>U</mi><mo accent="true">ÃÉ</mo></mover><mrow><mi>j</mi><mi>k</mi></mrow></msub><mo>=</mo><msub><mi>Œ≥</mi><mrow><mi>i</mi><mi>j</mi><mi>k</mi><mi>t</mi></mrow></msub><msub><mi>V</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
        E[Y_{ijkt} | \widetilde{U}_j, \widetilde{U}_{jk}] &amp;= \tilde{\mu} \ \gamma_{ijkt} \ \widetilde{U}_j \ \widetilde{U}_{jk} = \gamma_{ijkt} V_{jk}
\end{align*}</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ≥</mi><mrow><mi>i</mi><mi>j</mi><mi>k</mi><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">\gamma_{ijkt}</annotation></semantics></math>
denotes the effect of the company-specific covariates. To estimate this
model using Ohlsson‚Äôs GLMC algorithm <span class="citation">(Ohlsson
2008)</span>, we use can either use the function
<code>hierCredGLM</code> or <code>hierCredTweedie</code>.
<code>hierCredGLM</code> allows the user to specify the power parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>.
Conversely, <code>hierCredTweedie</code> estimates the power parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
along with the other parameters using the <code>cpglm</code> function
from the <code>cplm</code> package.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"tweedietraindata"</span><span class="op">)</span></span>
<span><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="../reference/hierCredGLM.html">hierCredGLM</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">cluster</span> <span class="op">/</span> <span class="va">subcluster</span><span class="op">)</span>, <span class="va">tweedietraindata</span>, weights <span class="op">=</span> <span class="va">wt</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; hierCredGLM(formula = y ~ x1 + (1 | cluster/subcluster), data = tweedietraindata, </span></span>
<span><span class="co">#&gt;     weights = wt)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Combination of the hierarchical credibility model with a GLM</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimated variance parameters:</span></span>
<span><span class="co">#&gt;   Individual contracts: 28.85133 </span></span>
<span><span class="co">#&gt;   Var(V[jk]): 10.07228 </span></span>
<span><span class="co">#&gt;   Var(V[j]): 15.34966 </span></span>
<span><span class="co">#&gt; Unique number of categories of cluster: 5</span></span>
<span><span class="co">#&gt; Unique number of categories of subcluster: 25</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Results contract-specific risk factors:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; glm(formula = FormulaGLM, family = tweedie(var.power = p, link.power = 0), </span></span>
<span><span class="co">#&gt;     data = data, weights = data$wijkt, model = T, y = T)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)  1.16305    0.04311  26.980  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; x1          -0.24828    0.04363  -5.691 1.57e-08 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for Tweedie family taken to be 1.792246)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 1768.4  on 1249  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 1712.0  on 1248  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 4</span></span></code></pre></div>
<p>We use the same syntax as used by the package <code>lme4</code> to
specify the model formula. Here,
<code>(1 | VehicleType / VehicleBody)</code> specifies a random effect
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>U</mi><mi>j</mi></msub><annotation encoding="application/x-tex">U_j</annotation></semantics></math>
for <code>VehicleType</code> and a nested random effect
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>U</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub><annotation encoding="application/x-tex">U_{jk}</annotation></semantics></math>
for <code>VehicleBody</code>. We extract the estimated parameters using
<code>fixef</code> (company-specific effects) and <code>ranef</code>
(random effects).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fixef.html">fixef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; (Intercept)          x1 </span></span>
<span><span class="co">#&gt;   1.1630511  -0.2482805</span></span>
<span><span class="fu"><a href="../reference/ranef.html">ranef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; $sector</span></span>
<span><span class="co">#&gt; Key: &lt;cluster&gt;</span></span>
<span><span class="co">#&gt;    cluster        Uj</span></span>
<span><span class="co">#&gt;      &lt;int&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:       1 0.4386663</span></span>
<span><span class="co">#&gt; 2:       2 1.0456717</span></span>
<span><span class="co">#&gt; 3:       3 0.3876805</span></span>
<span><span class="co">#&gt; 4:       4 3.1619372</span></span>
<span><span class="co">#&gt; 5:       5 0.8244171</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $group</span></span>
<span><span class="co">#&gt; Key: &lt;cluster, subcluster&gt;</span></span>
<span><span class="co">#&gt;     cluster subcluster       Ujk</span></span>
<span><span class="co">#&gt;       &lt;int&gt;      &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt;  1:       1          1 0.1848503</span></span>
<span><span class="co">#&gt;  2:       1          2 0.7644592</span></span>
<span><span class="co">#&gt;  3:       1          3 1.8658027</span></span>
<span><span class="co">#&gt;  4:       1          4 0.9610158</span></span>
<span><span class="co">#&gt;  5:       1          5 0.3841878</span></span>
<span><span class="co">#&gt;  6:       2          6 2.6271707</span></span>
<span><span class="co">#&gt;  7:       2          7 0.9485389</span></span>
<span><span class="co">#&gt;  8:       2          8 0.4156788</span></span>
<span><span class="co">#&gt;  9:       2          9 0.2814473</span></span>
<span><span class="co">#&gt; 10:       2         10 0.7558246</span></span>
<span><span class="co">#&gt; 11:       3         11 0.1849783</span></span>
<span><span class="co">#&gt; 12:       3         12 0.2949253</span></span>
<span><span class="co">#&gt; 13:       3         13 1.4783879</span></span>
<span><span class="co">#&gt; 14:       3         14 1.1272440</span></span>
<span><span class="co">#&gt; 15:       3         15 0.8780507</span></span>
<span><span class="co">#&gt; 16:       4         16 1.2055058</span></span>
<span><span class="co">#&gt; 17:       4         17 1.7166514</span></span>
<span><span class="co">#&gt; 18:       4         18 0.7795430</span></span>
<span><span class="co">#&gt; 19:       4         19 0.2942586</span></span>
<span><span class="co">#&gt; 20:       4         20 1.4527028</span></span>
<span><span class="co">#&gt; 21:       5         21 1.3115036</span></span>
<span><span class="co">#&gt; 22:       5         22 0.7205374</span></span>
<span><span class="co">#&gt; 23:       5         23 0.1888783</span></span>
<span><span class="co">#&gt; 24:       5         24 0.7047146</span></span>
<span><span class="co">#&gt; 25:       5         25 1.9346121</span></span>
<span><span class="co">#&gt;     cluster subcluster       Ujk</span></span></code></pre></div>
<p>In addition, the same functions as before can be used.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;         1         2         3         4         5         6 </span></span>
<span><span class="co">#&gt; 0.2235310 0.3427618 0.3112119 0.2736961 0.3682568 0.2467152</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, newdata <span class="op">=</span> <span class="va">tweedietraindata</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="op">]</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="co">#&gt;         1         2 </span></span>
<span><span class="co">#&gt; 0.2235310 0.3427618</span></span>
<span><span class="va">ggPlots</span> <span class="op">=</span> <span class="fu"><a href="../reference/plotRE.html">plotRE</a></span><span class="op">(</span><span class="va">fit</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="mixed-models">Mixed models<a class="anchor" aria-label="anchor" href="#mixed-models"></a>
</h4>
<p>Alternatively, we can rely on the mixed models framework <span class="citation">(Molenberghs and Verbeke 2005)</span> to estimate the
model parameters. Here, we can use the function to estimate a Tweedie
generalized linear mixed model. Fitting the model, however, takes quite
some time. We can speed up the fitting process by providing some initial
estimates and this is exactly what the <code>tweedieGLMM</code> function
does! Nonetheless, even with the initial estimates the fitting process
does take some time (approximately 5 minutes using Windows 10 with an
intel i7 and 32 gigabytes of RAM).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fitGLMM</span> <span class="op">=</span> <span class="fu"><a href="../reference/tweedieGLMM.html">tweedieGLMM</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">cluster</span> <span class="op">/</span> <span class="va">subcluster</span><span class="op">)</span>, <span class="va">tweedietraindata</span>, weights <span class="op">=</span> <span class="va">wt</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="balance-property">Balance property<a class="anchor" aria-label="anchor" href="#balance-property"></a>
</h4>
<p>For insurance applications, it is crucial that the models provide us
a reasonable premium volume at portfolio level. Hereto, we examine the
balance property [<span class="citation">B√ºhlmann and Gisler
(2006)</span>]<span class="citation">(W√ºthrich 2020)</span> on the
training set. That is,
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><munder><mo>‚àë</mo><mrow><mi>i</mi><mo>,</mo><mi>j</mi><mo>,</mo><mi>k</mi><mo>,</mo><mi>t</mi></mrow></munder><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi><mi>k</mi><mi>t</mi></mrow></msub><mspace width="0.222em"></mspace><msub><mi>Y</mi><mrow><mi>i</mi><mi>j</mi><mi>k</mi><mi>t</mi></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><munder><mo>‚àë</mo><mrow><mi>i</mi><mo>,</mo><mi>j</mi><mo>,</mo><mi>k</mi><mo>,</mo><mi>t</mi></mrow></munder><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi><mi>k</mi><mi>t</mi></mrow></msub><mspace width="0.222em"></mspace><msub><mover><mi>Y</mi><mo accent="true">ÃÇ</mo></mover><mrow><mi>i</mi><mi>j</mi><mi>k</mi><mi>t</mi></mrow></msub></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}
    \begin{aligned}
        \sum_{i, j, k, t} w_{ijkt} \ Y_{ijkt} &amp;= \sum_{i, j, k, t} w_{ijkt} \ \widehat{Y}_{ijkt}\\
    \end{aligned}
\end{equation}</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
serves as an index for the tariff class. GLMs fulfill the balance
property when we use the canonical link (see <span class="citation">(W√ºthrich 2020)</span>). For LMMs and hence, the
hierarchical credibility model this property also holds. Conversely,
most GLMMs do not have this property. To regain the balance property, we
introduce a quantity
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ±</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>Œ±</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mfrac><mrow><munder><mo>‚àë</mo><mrow><mi>i</mi><mo>,</mo><mi>j</mi><mo>,</mo><mi>k</mi><mo>,</mo><mi>t</mi></mrow></munder><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi><mi>k</mi><mi>t</mi></mrow></msub><mspace width="0.222em"></mspace><msub><mi>Y</mi><mrow><mi>i</mi><mi>j</mi><mi>k</mi><mi>t</mi></mrow></msub></mrow><mrow><munder><mo>‚àë</mo><mrow><mi>i</mi><mo>,</mo><mi>j</mi><mo>,</mo><mi>k</mi><mo>,</mo><mi>t</mi></mrow></munder><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi><mi>k</mi><mi>t</mi></mrow></msub><mspace width="0.222em"></mspace><msub><mover><mi>Y</mi><mo accent="true">ÃÇ</mo></mover><mrow><mi>i</mi><mi>j</mi><mi>k</mi><mi>t</mi></mrow></msub></mrow></mfrac></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation}
    \begin{aligned}
        \alpha &amp;= \frac{\sum_{i, j, k, t} w_{ijkt} \ Y_{ijkt}}{\sum_{i, j, k, t} w_{ijkt} \ \widehat{Y}_{ijkt}}\\
    \end{aligned}
\end{equation}</annotation></semantics></math> which quantifies the
deviation of the total predicted damage from the total observed damage.
In case of the log link, we can then use
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ±</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
to update the intercept to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>Œº</mi><mo accent="true">ÃÇ</mo></mover><mo>+</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œ±</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\hat{\mu} + \log(\alpha)</annotation></semantics></math>
to regain the balance property.</p>
<p>By default, the intercept is updated when fitting models using
<code>hierCredGLM</code>, <code>hierCredTweedie</code> and
<code>tweedieGLMM</code>. If you do not wish to update the intercept,
you can set the argument <code>balanceProperty = FALSE</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fitnoBP</span>  <span class="op">=</span> <span class="fu"><a href="../reference/hierCredGLM.html">hierCredGLM</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">cluster</span> <span class="op">/</span> <span class="va">subcluster</span><span class="op">)</span>, <span class="va">tweedietraindata</span>, weights <span class="op">=</span> <span class="va">wt</span>, balanceProperty <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="va">yHatnoBP</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">fitnoBP</span><span class="op">)</span></span>
<span><span class="va">w</span>        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/weights.html" class="external-link">weights</a></span><span class="op">(</span><span class="va">fitnoBP</span>, <span class="st">"prior"</span><span class="op">)</span></span>
<span><span class="va">y</span>        <span class="op">=</span> <span class="va">fitnoBP</span><span class="op">$</span><span class="va">y</span></span>
<span></span>
<span><span class="va">fitBP</span>  <span class="op">=</span> <span class="fu"><a href="../reference/hierCredGLM.html">hierCredGLM</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">cluster</span> <span class="op">/</span> <span class="va">subcluster</span><span class="op">)</span>, <span class="va">tweedietraindata</span>, weights <span class="op">=</span> <span class="va">wt</span>, balanceProperty <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">yHatBP</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">fitBP</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">w</span> <span class="op">*</span> <span class="va">y</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">w</span> <span class="op">*</span> <span class="va">yHatnoBP</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.040507</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">w</span> <span class="op">*</span> <span class="va">y</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">w</span> <span class="op">*</span> <span class="va">yHatBP</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<p>Alternatively, you can use the build-in function
<code>BalanceProperty</code>. You can use this function with any object
that has the slots <code>fitted</code>, <code>weights</code> and
<code>y</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/BalanceProperty.html">BalanceProperty</a></span><span class="op">(</span><span class="va">fitnoBP</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in BalanceProperty(fitnoBP): </span></span>
<span><span class="co">#&gt; Balance property is not satisfied.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Ratio total observed damage to total predicted damage: 1.040507</span></span>
<span><span class="fu"><a href="../reference/BalanceProperty.html">BalanceProperty</a></span><span class="op">(</span><span class="va">fitBP</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Balance property is satisfied.</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Buhlmann2005" class="csl-entry">
B√ºhlmann, H., and A. Gisler. 2006. <em>Course in Credibility Theory and
Its Applications</em>. Berlin/Heidelberg: Springer.
</div>
<div id="ref-Dannenburg" class="csl-entry">
Dannenburg, D. R., R. Kaas, and M. J. Goovaerts. 1996. <em>Practical
Actuarial Credibility Models</em>. Amsterdam: IAE (Institute of
Actuarial Science; Econometrics of the University of Amsterdam).
</div>
<div id="ref-Hachemeister" class="csl-entry">
Hachemeister, C. A. 1975. <span>‚ÄúCredibility for Regression Models with
Application to Trend.‚Äù</span> In <em>Credibility, Theory and
Applications, Proceedings of the Berkeley Actuarial Research Conference
on Credibility</em>, 129‚Äì63.
</div>
<div id="ref-JewellModel" class="csl-entry">
Jewell, W. S. 1975. <em>The Use of Collateral Data in Credibility Theory
: A Hierarchical Model</em>. International Institute for Applied Systems
Analysis. Research Memoranda RM-75-24. Laxenburg: IIASA.
</div>
<div id="ref-Micci2001" class="csl-entry">
Micci-Barreca, D. 2001. <span>‚ÄúA Preprocessing Scheme for
High-Cardinality Categorical Attributes in Classification and Prediction
Problems.‚Äù</span> <em>SIGKDD Explorations</em> 3 (1): 27‚Äì32.
</div>
<div id="ref-Molenberghs2005" class="csl-entry">
Molenberghs, G., and G. Verbeke. 2005. <em>Models for Discrete
Longitudinal Data</em>. Springer Series in Statistics. New York, NY:
Springer New York.
</div>
<div id="ref-OhlssonJewell" class="csl-entry">
Ohlsson, E. 2005. <em>Simplified Estimation of Structure Parameters in
Hierarchical Credibility</em>. Mathematical Statistics, Stockholm
University.
</div>
<div id="ref-Ohlsson2008" class="csl-entry">
‚Äî‚Äî‚Äî. 2008. <span>‚ÄúCombining Generalized Linear Models and Credibility
Models in Practice.‚Äù</span> <em>Scandinavian Actuarial Journal</em> 2008
(4): 301‚Äì14.
</div>
<div id="ref-Ohlsson" class="csl-entry">
Ohlsson, E., and B. Johansson. 2010. <em>Non-Life Insurance Pricing with
Generalized Linear Models</em>. EAA Lecture Notes. Berlin, Heidelberg:
Springer Berlin Heidelberg : Imprint: Springer.
</div>
<div id="ref-Wuthrich" class="csl-entry">
W√ºthrich, M. V. 2020. <span>‚ÄúBias Regularization in Neural Network
Models for General Insurance Pricing.‚Äù</span> <em>European Actuarial
Journal</em> 10 (1): 179‚Äì202.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Campo Bavo D.C..</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
